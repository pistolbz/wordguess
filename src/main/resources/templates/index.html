<!DOCTYPE html>
<html lang="en">
<head>
    <title>Word Guessing Game</title>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            min-height: 100vh;
            padding: 2rem;
        }
        .gamearea {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }
        .game-container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        .start-button {
            font-size: 1.2rem;
            padding: 1rem 2rem;
            margin: 2rem 0;
        }
        .game-status {
            background: #e9ecef;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            text-align: left;
        }
        .guess-input {
            font-size: 1.1rem;
            padding: 0.5rem;
            margin-right: 1rem;
            border-radius: 5px;
            border: 2px solid #dee2e6;
        }
        .word-hint {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0d6efd;
            margin: 1rem 0;
        }
        .score-display {
            font-size: 1.2rem;
            color: #198754;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="mb-4">Word Guessing Game</h1>
        <button class="btn btn-primary start-button" onclick="startNewGame()">Start New Game</button>
        
        <div class="gamearea">
            <div id="game-status" class="game-status"></div>
            <div class="input-group mb-3">
                <input type="text" id="guess-word" class="form-control guess-input" placeholder="Enter your guess" />
                <button class="btn btn-success" onclick="makeGuess()">Make Guess</button>
            </div>
        </div>
    </div>

    <script>
        let playerId;
        const socket = new SockJS("/ws-wordguess");
        const stompClient = Stomp.over(socket);

        stompClient.connect({}, function(frame) {
            console.log("Connected: " + frame);

            stompClient.subscribe("/topic/session", function(response) {
                const session = JSON.parse(response.body);
                if (session.status === "PLAYING") {
                    updateGameStatus(session);
                } else if (session.status === "FINISHED") {
                    updateGameStatus(session);
                    let playerName = prompt("Please enter your name:", "");
                    if (playerName === null || playerName === "") {
                        playerName = "Anonymous";
                    }
                    alert("Hi " + playerName + ". Game over! Your score: " + session.score);
                    stompClient.send("/app/end", {}, JSON.stringify({
                        sessionId: session.id,
                        playerName: playerName,
                    }));
                    window.location.href = "/leaderboard";
                }
            });
        });

        function startNewGame() {
            playerId = "player_" + Math.random().toString(36).substring(2, 11);
            document.querySelector(".gamearea").style.display = "block";
            document.querySelector("#guess-word").value = "";
            stompClient.send("/app/start", {}, playerId);
        }

        function updateGameStatus(session) {
            const statusDiv = document.getElementById("game-status");
            statusDiv.innerHTML = `
                <h4 class="mb-3">Game Progress</h4>
                <div class="word-hint">Word Hint: ${session.currentWordHint}</div>
                <div class="score-display">Current Score: ${session.score}</div>
                <div class="game-info">
                    <p class="mb-1">Round: ${session.round}</p>
                    <p class="mb-1">Status: ${session.status}</p>
                    <p class="mb-1">Session ID: ${session.id}</p>
                    <p class="mb-1">Player ID: ${session.playerId}</p>
                </div>
            `;
            console.log("Session updated:", session);
        }

        function makeGuess() {
            const sessionId = document.querySelector("#game-status").textContent.match(/Session ID: (.*)/)[1];
            var word = document.querySelector("#guess-word").value;
            stompClient.send("/app/guess", {}, JSON.stringify({
                sessionId: sessionId,
                guessWord: word,
            }));
        }
    </script>
</body>
</html>
